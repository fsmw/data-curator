Most modern visualization authoring tools (e.g., Charticulator~\cite{ren2019charticulator}, Data Illustrator~\cite{liu2018data}, Lyra~\cite{satyanarayan2014lyra}) and libraries (e.g., ggplot2~\cite{wickham2009ggplot2}, Vega-Lite~\cite{satyanarayan2017vegalite}) expect tidy data~\cite{wickham2014tidy-data}, where every variable to be visualized is a column and each observation is a row. When the input data is in the tidy format, authors simply need to bind data columns to visual channels (e.g., \code{Date} $\mapsto x$-axis, \code{Temperature} $\mapsto y$-axis, \code{City} $\mapsto$ color in \cref{fig:sea-atl-temp-simple}). Otherwise, they need to prepare the data, even if the original data is clean and contains all information needed~\cite{bartram2021untidy}. Authors usually rely on data transformation libraries (e.g., tidyverse~\cite{wickham2019tidyverse}, pandas~\cite{the_pandas_development_team_2023_7741580}) or separate interactive tools (e.g., Wrangler~\cite{kandel2011wrangler}) to transform data into the appropriate format. However, authors need either programming experience or tool expertise to transform data, and they have to withstand the overhead of switching between visualization and data transformation steps. The challenge of data transformation remains a barrier in visualization authoring.

To address the data transformation challenge, we explore a fundamentally different approach for visualization authoring, leveraging an AI agent. We separate the high-level visualization intent ``\emph{what to visualize}'' from the low-level data transformation steps of ``\emph{how to format data to visualize},'' and automate the latter to reduce the data transformation burden. Specifically, we support two key types of data transformations (and their combinations) needed for visualization authoring:

\begin{itemize}
    \item \textbf{Reshaping}: A variable to be visualized is spread across multiple columns or one column includes multiple variables. For example, if authors want to create a different scatter plot from the table in \cref{fig:sea-atl-temp-simple} by mapping \code{Seattle} and \code{Atlanta} temperatures to $x,y$-axes (\cref{fig:sea-atl-temp-pivot-derived}-\circled{1}), they need to first ``pivot'' the table from long to wide format, because both variables of interest are stored in the \code{Temperature} column and are not readily available.
    \item \textbf{Derivation}: A variable needs to be extracted or derived from one or more existing columns. For example, if authors want to create a bar chart to show daily temperature differences between two cities (\cref{fig:sea-atl-temp-pivot-derived}-\circled{2}) and a histogram to count the number of days which city is warmer (\cref{fig:sea-atl-temp-pivot-derived}-\circled{3}), they need to derive the temperature difference and the name of the warmer city from the two cities' temperature columns, and map them to the $y$-axis and $x$-axis, respectively, and the city name to color channels of the corresponding charts. The derivation is also needed when the variable to be visualized requires analytical computation (e.g., aggregation, moving average, percentile) across multiple rows from a column in the table. For example, to plot a line chart to visualize the 7-day moving averages of \code{Seattle} temperatures (\cref{fig:sea-atl-temp-pivot-derived}-\circled{4}), the authors need to calculate the moving average using a window function and map it to  $y$-axis with \code{Date} on $x$-axis.
\end{itemize}

\begin{figure}[t]
    \centering
    \includegraphics[width=0.95\linewidth]{figures/intro-sea-atl-temp-simple.png}
    \caption{A dataset of Seattle and Atlanta daily temperatures in 2020 (left) and a scatter plot that visualizes them by mapping Date to $x$-axis, Temperature to $y$-axis, and City to color (right).}
    \label{fig:sea-atl-temp-simple}
\end{figure}


\begin{figure*}[ht]
    \centering
    \includegraphics[width=\linewidth]{figures/intro-sea-atl-pivot-derived-plots.png}
    \caption{Visualizations created from \code{df} in \cref{fig:sea-atl-temp-simple} that require data transformation: (1) a scatter plot with Seattle and Atlanta temperatures on $x,y$-axes, (2) a bar chart to visualize the temperature difference between the two cities, (3) a histogram to count the number of days each city being warmer, and (4) a smoothed line chart that shows the 7-day moving averages of Seattle temperature.}
    \label{fig:sea-atl-temp-pivot-derived}
\end{figure*}


In this paper, we introduce Data Formulator, an interactive visualization authoring tool that embodies a new paradigm, \emph{concept binding}. To create a visualization with Data Formulator, authors provide their visualization intent by binding data concepts to visual channels. Upon loading of a data table, existing data columns are provided as known data concepts. When the required data concepts are not available to author a given chart, the authors can create the concepts: either using natural language prompts (for derivation) or by providing examples (for reshaping). Data Formulator handles these two cases differently, with different styles of input and feedback, and we provide a detailed description of how they are handled in \cref{sec:user-experience}. Once the necessary data concepts are available, the authors can select a chart type (e.g., scatter plot, histogram) and map data concepts to desired visual channels. If needed, Data Formulator dispatches the backend AI agent to infer necessary data transformations to instantiate these new concepts based on the input data and creates candidate visualizations. Because the authors' high-level specifications can be ambiguous and Data Formulator may generate multiple candidates, Data Formulator provides feedback to explain and compare the results. With this feedback, the authors can inspect, disambiguate, and refine the suggested visualizations. After that, they can reuse or create additional data concepts to continue their visualization authoring process.

We also report a chart reproduction study conducted with 10 participants to gather feedback on the new concept binding approach that employs an AI agent, and to evaluate the usability of Data Formulator. After an hour-long tutorial and practice session, most participants could create desired charts by creating data conceptsâ€”both with derivation and reshaping transformations. We conclude with a discussion on the lessons learned from the design and evaluation of Data Formulator, as well as important future research directions.